From 0613312d8f7b71734d23132f99cc196ba48292dd Mon Sep 17 00:00:00 2001
From: Brian Kim <brian.kim@hardkernel.com>
Date: Thu, 17 Nov 2016 12:33:24 +0900
Subject: [PATCH 2/2] Modify the Makefile for buildroot

Signed-off-by: Brian Kim <brian.kim@hardkernel.com>
---
 Makefile | 30 +++++++++++-------------------
 1 file changed, 11 insertions(+), 19 deletions(-)

diff --git a/Makefile b/Makefile
index b82ba0f..48a46f3 100755
--- a/Makefile
+++ b/Makefile
@@ -6,7 +6,8 @@
 CC = g++
 
 # define any compile-time flags
-CFLAGS = -g -std=c++11
+CFLAGS = -MMD -MF .$(@F).d -g -std=c++11
+DEPS = .*.d
 
 # define any directories containing header files other than /usr/include
 #
@@ -16,12 +17,12 @@ INCLUDES =
 # define library paths in addition to /usr/lib
 #   if I wanted to include libraries not in /usr/lib I'd specify
 #   their path using -Lpath, something like:
-LFLAGS = -lrt -L/usr/lib/aml_libs
+LFLAGS = -L$(STAGING_DIR)/lib -L$(STAGING_DIR)/usr/lib -L$(STAGING_DIR)/usr/lib/aml_libs
 
 # define any libraries to link into executable:
 #   if I want to link in libraries (libx.so or libx.a) I use the -llibname 
 #   option, something like (this will link in libmylib.so and libm.so:
-LIBS = -lavformat -lavcodec -lavutil -lamcodec -lamadec -lamavutils -lpthread -lasound
+LIBS = -lrt -lavformat -lavcodec -lavutil -lamcodec -lamadec -lamavutils -lpthread -lasound
 
 # define the C source files
 #SRCS = Pin.cpp \
@@ -51,7 +52,7 @@ MAIN = c2play
 # deleting dependencies appended to the file from 'make depend'
 #
 
-.PHONY: depend clean
+.PHONY: all install clean
 
 all:    $(MAIN)
 	@echo compiled
@@ -59,27 +60,18 @@ all:    $(MAIN)
 $(MAIN): $(OBJS) 
 	$(CC) $(CFLAGS) $(INCLUDES) -o $(MAIN) $(OBJS) $(LFLAGS) $(LIBS)
 
-
-# dependencies
-%.d: %.cpp
-	@set -e; rm -f $@; \
-	$(CC) -M $(CPPFLAGS) $< > $@.$$$$; \
-	sed 's,\($*\)\.o[ :]*,\1.o $@ : ,g' < $@.$$$$ > $@; \
-	rm -f $@.$$$$
-
-include $(SRCS:.cpp=.d)
-
 # this is a suffix replacement rule for building .o's from .c's
 # it uses automatic variables $<: the name of the prerequisite of
 # the rule(a .c file) and $@: the name of the target of the rule (a .o file) 
 # (see the gnu make manual section about automatic variables)
-.cpp.o:
+%.o: %.cpp
 	$(CC) $(CFLAGS) $(INCLUDES) -c $<  -o $@
 
-clean:
-	$(RM) *.d *.o *~ $(MAIN)
+install:
+	install -m 755 $(MAIN) $(TARGET_DIR)/usr/bin
 
-depend: $(SRCS)
-	makedepend $(INCLUDES) $^
+clean:
+	$(RM) $(DEPS) *.o *~ $(MAIN)
 
+-include $(DEPS)
 # DO NOT DELETE THIS LINE -- make depend needs it
-- 
2.7.4

